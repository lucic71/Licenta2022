\newcommand\multirowline[1]{\begin{tabular}{@{}c@{}}#1\end{tabular}}

\section{Porting Costs Evaluation} \label{sec:eval}

% What I want to say in this section:
%   - I want to take the model of Tanaka and map my timeline on it (maybe merge
%   the model with [1])
%   - I want to talk about the porting tasks
%     - which was most time consuming
%     - which of them were repetitive and added little value
%     - etc
%   - I want to talk about the human and development factors as described in [1]
%   - talk about environment disparity and program factors; and how did this
%   affect the costs
%   - Finally I need to understand the equations for porting costs evaluation
%   and estimation in order to compare the resluts (and maybe talk about the
%   porting productivity index)
%   - I don't know if I should place it here or in implementation chapter but
%   I would like to have a table with portability impedimets,reason for changes,
%   details of changes and need for change in future porting. They do so in
%   Tanaka et al
%
% LucianM proposed to talk about some aspects of the program to be ported as:
%   - size
%   - content
%
% The Tanaka+Hakuta model mapped on our timeline will be presented in a table.
% The indices from Hakuta([1]) will be presented in different subsection (idk).
%
% [1] "A study of Software Portability Evaluation"

In this section we present the costs associated with the porting process
described in Section~\ref{sec:portingIxos}. First we divide our work in tasks
that can be individually evaluated and later we discuss the factors that
affected our cost evaluation.

\subsection{Porting IxOS on ARM Boards Costs}

To evaluate the costs for porting IxOS infrastructure we divided our work based
on the model described in Section~\ref{sec:background}. Using the progress
tracking done during the project, we extracted the time spent on each task. We
use man-hours to evaluate the cost for each task. The results of this process
is shown in Table\~ref{tab:manHoursEvaluation}.

\begin{table*}
\centering
\begin{tabular}{ |l *{5}{|l}| }
\hline
Porting task & Subtasks & \multirowline{Man\\-hours} & \multirowline{Subtotals\\/subtask (\%)} & \multirowline{Subtotals\\/task (\%)} \\
\hline
\multirow{7}{5em}{Advance preparations} & \multirowline{Surveying development \\ environment} & 15   & 4.16 & \multirow{7}{5em}{14.35}\\
                                        \cline{2-4}
                                        & Surveying target OS                                 & 5    & 1.38 &                         \\
                                        \cline{2-4}
                                        & Surveying program for porting                       & 3    & 0.83 &                         \\
                                        \cline{2-4}
                                        & Surveying documentation                             & 5    & 1.38 &                         \\
                                        \cline{2-4}
                                        & \multirowline{Adjusting development \\ environment} & 10   & 2.77 &                         \\
                                        \cline{2-4}
                                        & Adjusting target environment                        & 13.8 & 3.83 &                         \\
                                        \cline{2-4}
                                        & Initial source code modifications                   & 0    & 0    &                         \\
\hline
\multirow{5}{5em}{Building for target environment} & \multirowline{Build system triggering and \\ modifcation}                          & 67.56 & 18.76 & \multirow{5}{5em}{32.71} \\
                                                   \cline{2-4}
                                                   & \multirowline{Installation on remote \\ environment}                               & 15.26 & 4.23  &                          \\
                                                   \cline{2-4}
                                                   & \multirowline{Reviewing inconsistencies between \\ source and remote environments} & 23.03 & 6.39  &                          \\
                                                   \cline{2-4}
                                                   & \multirowline{Solving problems with external \\ dependencies}                      & 12    & 3.33  &                          \\
\hline
\multirow{2}{5em}{Testing} & Testing in simulated environment & 33.35  & 9.26  & \multirow{2}{5em}{24.53} \\
                           \cline{2-4}
                           & Testing in target environment    & 55     & 15.27 &                          \\
\hline
\multirow{3}{5em}{General duties} & Documentation     & 30 & 8.33  & \multirow{3}{5em}{28.26} \\
                                  \cline{2-4}
                                  & Progress tracking & 12 & 3.33  &                          \\
                                  \cline{2-4}
                                  & Discussions       & 60 & 16.66 &                          \\
\hline
\multirow{1}{5em}{Total} & & 360  & 100 & \multirow{1}{5em}{100}\\
\hline
\end{tabular}
\caption{Man-hours evaluation for porting tasks}
\label{tab:manHoursEvaluation}
\end{table*}

\todo{rewrite}
As seen from the table the most time consuming subtask are the following:
discussions, incosistencies reviewing, installation on remote environment and
build system triggering and modification. The amount of time spent on these tasks is different. While
discussions and inconsistencies reviewing were planned during the day, taking
a predefined amount of time, installation on remote environment and build system trigerring
were repetitive and sporadic tasks. However this does not decrease the
importance of the later tasks, they were time consuming because they helped us
to achieve other tasks, mainly testing tasks.

Another thing that stands out is that we spent zero days on initial source code
modifications. This happened because the code base was too unfamiliar in order
to make source code modifications from the start. The first source code
modifications were present in the reviewing inconsistencies stage because the
toolchain helped us to discover the code zones to be changed.

\subsection{Factors of porting costs}

While porting costs, in our case man-hours, are determined dirctly by program
size and content, other factors and impediments as human experience and
environment disparities must be taken into consideration.

To determine the impact some of these factors had on our porting process, we
use the indices described in Hakuta and Ohminami~\cite{b2} that give
a quantitative influence of porting factors and impediments.

\subsubsection{Portability Impediment Index}

\todo{add a little intro here?}
The first index that we compute is the portability impediment index.  In our
case $eta$ has a value of 2, meaning that "the non-portable parts of the program
are not localized, but the correspondence of program codes to their functions is
clarified". For simplicity we will assume that $\omega_i$ is 0 if the impediment
was insignificant, 0.5 if the impediment had a normal difficulty and 1 if the
impediment was hard to solve. In our porting we discovered the following
portability impediments:
\begin{itemize}
    \item Difference in compiler specification (S8)
    \item Scope of library support (S9)
    \item Implementation-dependent libraries (S10)
    \item Difference in operating system interface (S12)
\end{itemize}

It can be noted that we added an additional impediment inexistent in Hakuta and
Ohminami's list~\cite{b2}, namely S12, which can be placed in the "OS disparity"
category. This impediment is reflected in the usage of dmidecode(8) on Raspberry
Pi Linux versus on x86 Linux. On Raspberry Pi we were not allowed to access
/dev/kmem which was needed by dmidecode(8), which in turn was needed by
InterfaceManager.

Given these impediments the portability impediment index has the following
value: $\alpha_p = 2 * (0.5 * S8 + 1 * S9 + 1 * S10 + 0.5 * S12) = 6$. The
maximum value for $\alpha_p$ is 36 as seen in Figure~\ref{fig:PII}. This PII is
resulted because there were no differences between processor architecture
(S1~S5), little difference between source and target OSes (S6, S7, S12) and a
major difference in language processor (S8~S11). The application was written in
C++ and the port was between two Linux versions, which highly decreased the
impediments we could have faced. The degree of portability of the program to be
ported is highlighted in Figure~\ref{fig:PII}, being very close to the optimal
value.

\begin{figure}
    \begin{tikzpicture}[
        dot/.style = {circle, fill=black,inner sep=0pt, minimum size=4pt},
        every label/.append style = {inner sep=0pt, rotate around={45:(-0.5,1.5)}},
            thick      
    ]
        \draw (0,0.2) -- + (0,-0.4) node[below] {EASIEST=0};
        \draw (6,0.2) -- + (0,-0.4) node[below] {HARDEST=36};
        \draw[thick] (0,0) -- node[below=2mm] {} + (6,0);
        \node[dot,label={PII=6}] at (1,0) {};
    \end{tikzpicture}

    \caption{Portability Impediment Index \todo{fixme}}
    \label{fig:PII}
\end{figure}


\subsubsection{Human Factors Index}

Software programs are byproducts of human activities than incorporate our
problem-solving capabilities, cognitive aspects and social
interaction~\cite{b5}, therefore it is vital to understand what role did the
human factors play in our porting so that we can assess the quality of the
porting process. 

\todo{what do the numbers mean?}
In our case $\alpha_h = 2 + (-1) + 2 + 1 + 2 = 6$. As seen in
Figure~\ref{fig:HFI}, the HFI has a score very close to the lowest possible
score. Indeed, the human factor played a major role in our porting process, let
us analyze each factor and see what went wrong.

\begin{figure}
    \begin{tikzpicture}[
        dot/.style = {circle, fill=black,inner sep=0pt, minimum size=4pt},
        every label/.append style = {inner sep=0pt, rotate around={45:(-0.5,1.5)}},
            thick      
    ]
        \draw (0,0.2) -- + (0,-0.4) node[below] {BEST=-10};
        \draw (6,0.2) -- + (0,-0.4) node[below] {WORST=10};
        \draw[thick] (0,0) -- node[below=2mm] {} + (6,0);
        \node[dot,label={HFI=6}] at (4.8,0) {};
    \end{tikzpicture}

    \caption{Human Factors Index \todo{fixme}}
    \label{fig:HFI}
\end{figure}

\textit{Knowledge about the program to be ported functions and structures (H1)} 
\todo{i don't like the "my" part}
As this was my first interaction with the program to be ported it was hard to
familiarize with its functions and structures, therefore I had no experience
whatsoever with the use cases of the program. This resulted in the inability to
easily solve the porting problems that appeared in our way.

\textit{Knowledge about the hardware and OS of the target system (H2)}
Hardware disparities were not a big concern in our porting as we used a portable
operating system and programming language that abstracted out hardware problems.
Therefore the focus was on the target operating system. Our porting moved the
program from an older version of Linux to a newer one. This helped us as we
did not have to learn the peculiarities of another operating system so that we
could finish our porting. However there were some problems that we faced
regarding the target operating system that we solved relatively straight
forward.

\textit{Knowledge and experience in the area of software porting (H3)}
As the experience of software porting was lacking there were many situations
and problems that could have been solved better, for example: doing better
tracking of the porting process, putting more effort in technical discussions
in order to better understand the problems, etc.

\textit{Knowledge of and experience with the language and program to be ported
in use(H4)}
The experience with the programming language (C++) helped us to grow the
productivity of the porting process as we did not have to care about low-level
impediments as endianness or data alignment. However we did have problems with
the language specification between different compilation toolchains that costed
us a whole week to solve. Finally, the experience with use cases of the program
to be ported was lacking. \todo{continue the ideas about the last phrase}

\textit{Knowledge about the functions and usage of tools used in the development
and testing environment (H5)}
While working in the development and testing environments we used a considerable
number of technologies, some of them being either new or not trivial to work
with. Here is a short list of these technologies: QEMU networking, SCons build
system, Perforce versioning system and internal tools as packaging system.
\todo{continue the ideas about the last phrase}

In retrospect, it seems that if the human factor index had a better score, maybe
the porting process would have lasted less and the problems we faced would not
even occur. \todo{fixme}

\subsubsection{Environmental Factors Index}

\todo{add intro}
In our porting we did not use any kind of unit testing so we will discard E2
from our discussion.

In the development environment we had no documentation describing the compiling
and linking procedures and no documentation regarding the environment dependent
components that we need to modify in order to move the code to a new
environment. We modified the code and the build system by trial and error. This
reduces the score for E1 as this strategy might not always work or it could take
an unsatisfactory amount of time for large and complicated systems. However
we managed to understand the peculiarities of the development environment and
get the first builds available for testing in two or three weeks, which is less
than 25\% of our porting time.

In the testing environment we had test programs and tools available such as
emulators and debuggers, furthermore the file transfer and conversion tools
were available from the start of the project. This facilitated the testing of
our program to be ported by allowing us to focus on the porting inconsistencies
rather than on testing infrastructure. Things were not perfect however, we did
have problems with the testing infrastructure that we solved in a short period
of time (\todo{add reference to porting difficulties} ).

That being said, the environmental factors index has the following value in our
case: \todo{what do these numbers mean?} $\alpha_e = 0 + NA + -1 = -1$. As seen in Figure~\ref{fig:EFI} we are in the
satisfactory half of the index, meaning that even if we had some difficulties
setting and understanding the development and testing environment, we managed
to work with them in order to achieve our goals.

\begin{figure}
    \begin{tikzpicture}[
        dot/.style = {circle, fill=black,inner sep=0pt, minimum size=4pt},
        every label/.append style = {inner sep=0pt, rotate around={45:(-0.5,1.5)}},
            thick      
    ]
        \draw (0,0.2) -- + (0,-0.4) node[below] {BEST=-6};
        \draw (6,0.2) -- + (0,-0.4) node[below] {WORST=6};
        \draw[thick] (0,0) -- node[below=2mm] {} + (6,0);
        \node[dot,label={EFI=-1}] at (2,0) {};
    \end{tikzpicture}

    \caption{Environmental Factors Index \todo{fixme}}
    \label{fig:EFI}
\end{figure}

\todo{ending thoughts}
